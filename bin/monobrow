#!/usr/bin/env node

var path = require('path');
var minimist = require('minimist')
var argv = minimist(process.argv.slice(2));

var configPath = argv.c || argv.config;
var config = require(path.join(process.cwd(), configPath));

var browserify = require('browserify');

var b;
var bundle;

if (config.watch) {
  var watchify = require('watchify');
  b = watchify(browserify(watchify.args));

  bundle = require('../lib/watchify-bundle')(b, config);
}
else {
  b = browserify();
  bundle = require('../lib/browserify-bundle')(b, config);
}

config.setup(b);

var entryFilename = config.entry[0] === '/' ?
    config.entry :
    path.join(path.dirname(configPath), config.entry);

b.add(entryFilename);
bundle();
